<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockMaster Pro | Professional Inventory Management</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@500;600;700;800&display=swap"
        rel="stylesheet">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <!-- Framer Motion (Motion) -->
    <script src="https://cdn.jsdelivr.net/npm/motion@11.11.17/dist/motion.js"></script>
</head>

<body>
    <div class="app-layout">
        <!-- Sidebar Navigation -->
        <nav class="sidebar" id="sidebar">
            <div class="brand">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <ion-icon name="cube" class="brand-icon"></ion-icon>
                    <span class="amman-text">AMMAN</span>
                </div>
                <button class="icon-btn mobile-only" onclick="toggleSidebar()" style="margin-left: auto;">
                    <ion-icon name="close-outline"></ion-icon>
                </button>
            </div>
            <ul class="nav-links">
                <li class="active" onclick="switchView('dashboard', this)">
                    <ion-icon name="grid-outline"></ion-icon>
                    <span>Dashboard</span>
                </li>
                <li onclick="switchView('inventory', this)">
                    <ion-icon name="layers-outline"></ion-icon>
                    <span>Inventory</span>
                </li>
                <li onclick="switchView('buy', this)">
                    <ion-icon name="arrow-down-circle-outline"></ion-icon>
                    <span>Buy Stock</span>
                </li>
                <li onclick="switchView('sell', this)">
                    <ion-icon name="arrow-up-circle-outline"></ion-icon>
                    <span>Sell Stock</span>
                </li>
                <li onclick="switchView('reports', this)">
                    <ion-icon name="bar-chart-outline"></ion-icon>
                    <span>Reports</span>
                </li>
                <li onclick="switchView('growth', this)">
                    <ion-icon name="trending-up-outline"></ion-icon>
                    <span>Growth Trajectory</span>
                </li>
                <li onclick="switchView('settings', this)">
                    <ion-icon name="settings-outline"></ion-icon>
                    <span>Settings</span>
                </li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Sidebar Overlay -->
            <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>

            <!-- Header -->
            <header>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button class="icon-btn mobile-only" id="mobile-menu-btn" onclick="toggleSidebar()">
                        <ion-icon name="menu-outline"></ion-icon>
                    </button>
                    <h2 id="page-title">Dashboard</h2>
                </div>
                <div class="user-actions">
                </div>
            </header>

            <!-- VIEW: Dashboard -->
            <section id="view-dashboard" class="view active">
                <div class="stats-grid">
                    <div class="card stat-card stagger-item" onclick="showInventory()" style="cursor: pointer;">
                        <div class="stat-icon up"><ion-icon name="cash-outline"></ion-icon></div>
                        <div>
                            <h4>Total Asset Value</h4>
                            <h2 id="dash-total-value">₹0.00</h2>
                        </div>
                    </div>
                    <div class="card stat-card stagger-item" onclick="showLowStock()" style="cursor: pointer;">
                        <div class="stat-icon warn"><ion-icon name="alert-circle-outline"></ion-icon></div>
                        <div>
                            <h4>Low Stock Items</h4>
                            <h2 id="dash-low-stock">0</h2>
                        </div>
                    </div>
                    <div class="card stat-card stagger-item" onclick="showInventory()" style="cursor: pointer;">
                        <div class="stat-icon"><ion-icon name="cube-outline"></ion-icon></div>
                        <div>
                            <h4>Total Products</h4>
                            <h2 id="dash-total-products">0</h2>
                        </div>
                    </div>
                    <div class="card stat-card stagger-item" onclick="showOutOfStock()" style="cursor: pointer;">
                        <div class="stat-icon out"><ion-icon name="close-circle-outline"></ion-icon></div>
                        <div>
                            <h4>Out of Stock</h4>
                            <h2 id="dash-out-of-stock">0</h2>
                        </div>
                    </div>
                </div>

                <div class="dashboard-split">
                    <!-- Out of Stock Detail Section (Replaces Growth Chat) -->
                    <div class="card">
                        <div class="card-header">
                            <div style="display:flex; align-items:center; gap:10px;">
                                <div class="stat-icon out" style="width:32px; height:32px; font-size:1.2rem;"><ion-icon
                                        name="close-circle-outline"></ion-icon></div>
                                <h3>Out of Stock Details</h3>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="styled-table">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="dashboard-out-of-stock-body">
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div style="display:flex; align-items:center; gap:10px;">
                                <div class="stat-icon warn" style="width:32px; height:32px; font-size:1.2rem;">
                                    <ion-icon name="alert-circle-outline"></ion-icon>
                                </div>
                                <h3>Low Stock Alerts</h3>
                            </div>
                        </div>
                        <div id="low-stock-list" class="list-container">
                            <!-- Injected JS -->
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 24px;">
                    <div class="card-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div class="stat-icon" style="width:32px; height:32px; font-size:1.2rem;">
                                <ion-icon name="time-outline"></ion-icon>
                            </div>
                            <h3>Recent Activity</h3>
                        </div>
                    </div>
                    <div id="recent-activity-list" class="list-container">
                        <!-- Injected JS -->
                    </div>
                </div>
            </section>

            <!-- VIEW: Inventory -->
            <section id="view-inventory" class="view">
                <div class="toolbar">
                    <div class="search-wrap">
                        <ion-icon name="search-outline"></ion-icon>
                        <input type="text" id="inv-search" placeholder="Search products..." onkeyup="renderInventory()">
                    </div>
                    <button class="btn btn-primary" onclick="switchView('buy')">
                        <ion-icon name="add-circle-outline"></ion-icon> Buy / Add New Item
                    </button>
                </div>
                <div class="card table-card">
                    <table>
                        <thead>
                            <tr>
                                <th>S.No</th>
                                <th>Product</th>
                                <th>Brand</th>
                                <th>Category</th>
                                <th>Size</th>
                                <th>KG</th>
                                <th>Stock</th>
                                <th>Min Level</th>
                                <th>Buy Price</th>
                                <th>Sell Price</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-table-body">
                            <!-- JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- VIEW: Buy Stock -->
            <section id="view-buy" class="view">
                <div class="grid-2">
                    <!-- Buy Form -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Buy Stock (IN)</h3>
                        </div>
                        <form id="buy-form" onsubmit="handleTransaction(event, 'IN')">
                            <input type="hidden" name="type" value="IN">

                            <div class="form-group">
                                <label>Date</label>
                                <input type="date" id="buy-date" required>
                            </div>

                            <div class="form-group">
                                <label>Product Name</label>
                                <input type="text" id="buy-product-name" list="buy-names-list"
                                    placeholder="Type or select product..." required oninput="handleProductInput('IN')">
                            </div>

                            <div class="grid-2-inner">
                                <div class="form-group">
                                    <label>Brand (Optional)</label>
                                    <input type="text" id="buy-brand" list="buy-brands-list" placeholder="Brand"
                                        oninput="handleProductInput('IN')">
                                </div>
                                <div class="form-group">
                                    <label>Category (Optional)</label>
                                    <input type="text" id="buy-category" list="buy-cats-list" placeholder="Category"
                                        oninput="handleProductInput('IN')">
                                </div>
                            </div>

                            <div class="grid-2-inner">
                                <div class="form-group">
                                    <label>Size (Optional)</label>
                                    <input type="text" id="buy-size" list="buy-sizes-list" placeholder="Size"
                                        oninput="handleProductInput('IN')">
                                </div>
                                <div class="form-group">
                                    <label>KG (Optional)</label>
                                    <input type="text" id="buy-kg" list="buy-kgs-list" placeholder="KG"
                                        oninput="handleProductInput('IN')">
                                </div>
                            </div>

                            <!-- New Product "Smart" Fields (Initially Hidden) -->
                            <div id="buy-new-product-fields"
                                style="display:none; background:rgba(16, 185, 129, 0.1); padding:15px; border-radius:8px; border:1px solid rgba(16, 185, 129, 0.3); margin-bottom: 20px;">
                                <h4
                                    style="color:var(--success); margin-bottom:10px; display:flex; align-items:center; gap:8px;">
                                    <ion-icon name="sparkles"></ion-icon> New Product Detected
                                </h4>
                                <p style="font-size:0.85rem; color:var(--text-secondary); margin-bottom:15px;">
                                    This looks like a new item! Set its details now to save time.
                                </p>

                                <div class="form-group">
                                    <label>Unit Type</label>
                                    <select id="buy-new-unit" onchange="updateRefinedModalFields('buy')">
                                        <option value="Piece">Piece / Unit</option>
                                        <option value="Box">Box / Pack</option>
                                        <option value="KG">KG (Weight)</option>
                                        <option value="Meter">Meter (Length)</option>
                                    </select>
                                </div>

                                <div class="grid-2-inner">
                                    <div class="form-group" style="margin-bottom:0">
                                        <label>Selling Price</label>
                                        <input type="number" id="buy-new-sell-price" min="0" step="0.01"
                                            placeholder="0.00">
                                    </div>
                                    <div class="form-group" style="margin-bottom:0">
                                        <label>Min Stock Alert</label>
                                        <input type="number" id="buy-new-min-stock" min="0" value="5">
                                    </div>
                                </div>
                            </div>

                            <div class="form-group" id="buy-info-group"
                                style="display:none; background:rgba(255,255,255,0.05); padding:12px; border-radius:8px;">
                                <div
                                    style="display: flex; gap: 15px; align-items: center; justify-content: space-between;">
                                    <div>
                                        <label style="margin-bottom:4px; font-size:0.75rem;">Current Stock</label>
                                        <div id="buy-stock-display" style="font-weight:700;">-</div>
                                    </div>
                                </div>
                            </div>

                            <div class="grid-2-inner">
                                <div class="form-group">
                                    <div
                                        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                                        <label>Quantity</label>
                                        <!-- Unit Toggle (Hidden by default) -->
                                        <div id="buy-unit-toggle" style="display:none; gap:5px;">
                                            <button type="button" class="unit-btn active" data-mode="stock"
                                                onclick="setUnitMode('IN', 'stock')">Base</button>
                                            <button type="button" class="unit-btn" data-mode="bulk"
                                                onclick="setUnitMode('IN', 'bulk')">Bulk</button>
                                        </div>
                                    </div>
                                    <input type="number" id="buy-qty" min="0.001" step="0.001" required placeholder="0">
                                </div>
                                <div class="form-group">
                                    <label>Unit Price (Buy)</label>
                                    <input type="number" id="buy-price" min="0" step="0.01" required placeholder="0.00">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Remarks (Optional)</label>
                                <input type="text" id="buy-notes" placeholder="Supplier name, details...">
                            </div>

                            <button type="submit" class="btn btn-primary full-width">Record Purchase</button>
                        </form>
                    </div>

                    <!-- History -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Recent Purchases</h3>
                        </div>
                        <div class="list-container" id="buy-history-list">
                            <!-- JS -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- VIEW: Sell Stock -->
            <section id="view-sell" class="view">
                <div class="grid-2">
                    <!-- Sell Form -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Sell Stock (OUT)</h3>
                        </div>
                        <form id="sell-form" onsubmit="handleTransaction(event, 'OUT')">
                            <input type="hidden" name="type" value="OUT">

                            <div class="form-group">
                                <label>Date</label>
                                <input type="date" id="sell-date" required>
                            </div>

                            <div class="form-group">
                                <label>Product Name</label>
                                <select id="sell-product-name" required onchange="handleProductInput('OUT')">
                                    <option value="">Select Product...</option>
                                </select>
                            </div>

                            <div class="grid-2-inner">
                                <div class="form-group">
                                    <label>Brand (Optional)</label>
                                    <select id="sell-brand" onchange="handleProductInput('OUT')">
                                        <option value="">Select Brand...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Category</label>
                                    <select id="sell-category" onchange="handleProductInput('OUT')">
                                        <option value="">Select Category...</option>
                                    </select>
                                </div>
                            </div>

                            <div class="grid-2-inner">
                                <div class="form-group">
                                    <label>Size (Optional)</label>
                                    <select id="sell-size" onchange="handleProductInput('OUT')">
                                        <option value="">Select Size...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>KG (Optional)</label>
                                    <select id="sell-kg" onchange="handleProductInput('OUT')">
                                        <option value="">Select KG...</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group" id="sell-info-group"
                                style="display:none; background:rgba(255,255,255,0.05); padding:12px; border-radius:8px;">
                                <div
                                    style="display: flex; gap: 15px; align-items: center; justify-content: space-between;">
                                    <div>
                                        <label style="margin-bottom:4px; font-size:0.75rem;">Available Stock</label>
                                        <div id="sell-stock-display" style="font-weight:700;">-</div>
                                    </div>
                                    <div style="text-align:right">
                                        <label style="margin-bottom:4px; font-size:0.75rem;">Unit Cost (Buy)</label>
                                        <div id="sell-buy-price-display"
                                            style="font-weight:700; color:var(--text-secondary)">-
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="grid-2-inner">
                                <div class="form-group">
                                    <div
                                        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                                        <label>Quantity</label>
                                        <!-- Unit Toggle (Hidden by default) -->
                                        <div id="sell-unit-toggle" style="display:none; gap:5px;">
                                            <button type="button" class="unit-btn active" data-mode="stock"
                                                onclick="setUnitMode('OUT', 'stock')">Base</button>
                                            <button type="button" class="unit-btn" data-mode="bulk"
                                                onclick="setUnitMode('OUT', 'bulk')">Bulk</button>
                                        </div>
                                    </div>
                                    <input type="number" id="sell-qty" min="0.001" step="0.001" required
                                        placeholder="0">
                                </div>
                                <div class="form-group">
                                    <label>Unit Price (Sell)</label>
                                    <input type="number" id="sell-price" min="0" step="0.01" required
                                        placeholder="0.00">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Remarks (Optional)</label>
                                <input type="text" id="sell-notes" placeholder="Customer name, details...">
                            </div>

                            <button type="submit" class="btn btn-primary full-width"
                                style="background-color: var(--danger);">Record Sale</button>
                        </form>
                    </div>

                    <!-- History -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Recent Sales</h3>
                        </div>
                        <div class="list-container" id="sell-history-list">
                            <!-- JS -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Shared or Buy specific Datalists -->
            <datalist id="buy-names-list"></datalist>
            <datalist id="buy-brands-list"></datalist>
            <datalist id="buy-cats-list"></datalist>
            <datalist id="buy-sizes-list"></datalist>
            <datalist id="buy-kgs-list"></datalist>

            <!-- Sell Specific Datalists for Cascading -->
            <datalist id="sell-names-list"></datalist>
            <datalist id="sell-brands-list"></datalist>
            <datalist id="sell-cats-list"></datalist>
            <datalist id="sell-sizes-list"></datalist>
            <datalist id="sell-kgs-list"></datalist>

            <!-- VIEW: Reports -->
            <section id="view-reports" class="view">
                <div class="card" style="margin-bottom: 24px;">
                    <div class="grid-2-inner" style="margin-bottom: 24px;">
                        <div class="form-group">
                            <label>From Date</label>
                            <input type="date" id="report-date-from" onchange="runReports(currentReportFilter)">
                        </div>
                        <div class="form-group">
                            <label>To Date</label>
                            <input type="date" id="report-date-to" onchange="runReports(currentReportFilter)">
                        </div>
                    </div>
                    <div class="toolbar" style="margin-bottom: 0; flex-wrap:wrap; gap:10px;">
                        <button class="btn btn-primary" onclick="runReports('ALL')">
                            <ion-icon name="list"></ion-icon> All
                        </button>
                        <button class="btn btn-primary" onclick="runReports('IN')"
                            style="background-color: var(--success); border-color: var(--success);">
                            <ion-icon name="arrow-down"></ion-icon> Purchases
                        </button>
                        <button class="btn btn-primary" onclick="runReports('OUT')"
                            style="background-color: var(--danger); border-color: var(--danger);">
                            <ion-icon name="arrow-up"></ion-icon> Sales
                        </button>

                        <div class="report-btn-group" style="margin-left:auto;">
                            <button class="btn btn-primary" onclick="clearReportFilters()">
                                Clear
                            </button>
                            <button class="btn btn-primary" style="background:#ef4444; border-color:#ef4444"
                                onclick="downloadReportPDF()">
                                <ion-icon name="document-text-outline"></ion-icon> PDF
                            </button>
                        </div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="card stat-card">
                        <div class="stat-icon"><ion-icon name="cart-outline"></ion-icon></div>
                        <div>
                            <h4>Total Sales</h4>
                            <h2 id="report-sales">₹0.00</h2>
                        </div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-icon"><ion-icon name="wallet-outline"></ion-icon></div>
                        <div>
                            <h4>Total Purchases</h4>
                            <h2 id="report-cost">₹0.00</h2>
                        </div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-icon success"><ion-icon name="trending-up-outline"></ion-icon></div>
                        <div>
                            <h4>Net Profit</h4>
                            <h2 id="report-profit" class="text-success">₹0.00</h2>
                        </div>
                    </div>
                </div>

                <div class="card table-card" style="margin-top: 20px;">
                    <div class="card-header">
                        <h3>Transaction Report Log</h3>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>S.No</th>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Product</th>
                                <th>Qty</th>
                                <th>Total</th>
                                <th>Remarks</th>
                            </tr>
                        </thead>
                        <tbody id="report-table-body">
                            <!-- JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- VIEW: Growth Trajectory -->
            <section id="view-growth" class="view">
                <div class="card" style="margin-bottom: 24px;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <div>
                            <h2 style="margin-bottom: 5px;">Inventory Analytics</h2>
                            <p style="color: var(--text-muted); font-size: 0.9rem;">Real-time stock flow and growth
                                trajectory</p>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <div class="view-toggle">
                                <button class="toggle-btn" onclick="setGrowthPeriod('day')">Day</button>
                                <button class="toggle-btn" onclick="setGrowthPeriod('week')">Week</button>
                                <button class="toggle-btn active" onclick="setGrowthPeriod('monthly')">Month</button>
                                <button class="toggle-btn" onclick="setGrowthPeriod('yearly')">Year</button>
                            </div>
                            <div class="view-toggle" style="background: rgba(255,255,255,0.05);">
                                <button class="toggle-btn active" id="btn-mode-value"
                                    onclick="setGrowthMode('value')">Value</button>
                                <button class="toggle-btn" id="btn-mode-qty" onclick="setGrowthMode('qty')">Qty</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card chart-card">
                    <div class="card-header"
                        style="display: flex; justify-content: space-between; align-items: center;">
                        <h3 id="chart-main-title">Stock Flow Trajectory</h3>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span id="growth-percentage-display" style="font-weight: 700; font-size: 0.9rem;"></span>
                            <div id="chart-trend-badge" class="badge ok" style="display: none;">Stable</div>
                        </div>
                    </div>
                    <div class="chart-container" style="position: relative; height:450px; width:100%">
                        <canvas id="growthChart"></canvas>
                    </div>
                </div>

                <div class="stats-grid" style="margin-top: 24px;">
                    <div class="card growth-stat-card">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <div class="stat-icon up" style="width: 32px; height: 32px; font-size: 1rem;"><ion-icon
                                    name="arrow-down-circle"></ion-icon></div>
                            <h4 style="font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase;">Total
                                Purchased (IN)</h4>
                        </div>
                        <h2 id="growth-in-val">0</h2>
                        <span class="growth-label positive" id="growth-in-pct">+0%</span>
                    </div>
                    <div class="card growth-stat-card">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <div class="stat-icon out" style="width: 32px; height: 32px; font-size: 1rem;"><ion-icon
                                    name="arrow-up-circle"></ion-icon></div>
                            <h4 style="font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase;">Total
                                Sold (OUT)</h4>
                        </div>
                        <h2 id="growth-out-val">0</h2>
                        <span class="growth-label positive" id="growth-out-pct">+0%</span>
                    </div>
                    <div class="card growth-stat-card">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <div class="stat-icon"
                                style="width: 32px; height: 32px; font-size: 1rem; color: var(--brand-primary);">
                                <ion-icon name="layers"></ion-icon>
                            </div>
                            <h4 style="font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase;">Net
                                Available Stock</h4>
                        </div>
                        <h2 id="growth-net-val">0</h2>
                        <span class="growth-label positive" id="growth-net-pct">+0%</span>
                    </div>
                    <div class="card growth-stat-card">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <div class="stat-icon warn" style="width: 32px; height: 32px; font-size: 1rem;"><ion-icon
                                    name="trending-up"></ion-icon></div>
                            <h4 style="font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase;">Growth
                                Period</h4>
                        </div>
                        <h2 id="growth-period-label">-</h2>
                        <span class="growth-label" id="growth-overall-trend">Stable</span>
                    </div>
                </div>
            </section>

            <!-- VIEW: Settings -->
            <section id="view-settings" class="view">
                <div class="card">
                    <div class="card-header">
                        <h3>Data Management</h3>
                    </div>
                    <p style="color:var(--text-secondary); margin-bottom:20px;">
                        Save your data to a file to transfer between devices or keep a backup.
                    </p>

                    <div class="grid-2-inner">
                        <div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:10px;">
                            <h4>Backup Data</h4>
                            <p style="font-size:0.9rem; color:var(--text-secondary); margin:10px 0;">
                                Download a copy of your Stock and Transaction history.
                            </p>
                            <button class="btn btn-primary" onclick="downloadBackupJSON()">
                                <ion-icon name="code-download-outline"></ion-icon> Download Data (JSON)
                            </button>
                            <button class="btn btn-primary"
                                style="margin-top:10px; background:#ef4444; border-color:#ef4444"
                                onclick="downloadBackupPDF()">
                                <ion-icon name="document-text-outline"></ion-icon> Download Report (PDF)
                            </button>
                        </div>

                        <div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:10px;">
                            <h4>Restore Data</h4>
                            <p style="font-size:0.9rem; color:var(--text-secondary); margin:10px 0;">
                                Restore from a previously saved backup file.
                                <strong style="color:var(--danger)">Warning: overwrites current data.</strong>
                            </p>
                            <input type="file" id="restore-file" style="display:none" onchange="restoreData(this)">
                            <button class="btn" style="background:var(--warning); color:black"
                                onclick="document.getElementById('restore-file').click()">
                                <ion-icon name="cloud-upload-outline"></ion-icon> Restore Backup
                            </button>
                        </div>
                    </div>

                    <div style="margin-top:40px; border-top:1px solid var(--border); padding-top:20px;">
                        <h4 style="color:var(--danger)">Danger Zone</h4>
                        <button class="btn" style="background:var(--danger); color:white; margin-top:10px;"
                            onclick="removeAllData()">
                            <ion-icon name="trash-outline"></ion-icon> Wipe All Data
                        </button>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Product Modal -->
    <div id="product-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 id="product-modal-title">Edit Product Details</h3>
                <button onclick="closeProductModal()" class="icon-btn"><ion-icon name="close"></ion-icon></button>
            </div>
            <form onsubmit="saveProduct(event)">
                <input type="hidden" id="prod-id">
                <div class="form-group">
                    <label>Product Name</label>
                    <input type="text" id="prod-name" required placeholder="e.g. Wireless Mouse">
                </div>

                <div class="form-group">
                    <label>Unit Type</label>
                    <select id="prod-unit" onchange="updateRefinedModalFields()">
                        <option value="Box">Box / Pack</option>
                        <option value="Piece">Piece / Unit</option>
                        <option value="KG">KG (Weight)</option>
                        <option value="Meter">Meter (Length)</option>
                    </select>
                </div>

                <div class="grid-2-inner" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="form-group">
                        <label>Brand (Optional)</label>
                        <input type="text" id="prod-brand" placeholder="e.g. Tata">
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <input type="text" id="prod-category" placeholder="e.g. Steel">
                    </div>
                </div>

                <div class="grid-2-inner" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="form-group" id="prod-size-group">
                        <label>Size</label>
                        <input type="text" id="prod-size" placeholder="e.g. 12 Inch">
                    </div>
                    <div class="form-group" id="prod-kg-group">
                        <label>KG / Weight (per unit)</label>
                        <input type="text" id="prod-kg" placeholder="e.g. 2.5">
                    </div>
                </div>

                <div class="form-group">
                    <label>Min Stock Level</label>
                    <input type="number" id="prod-min" min="0" value="5">
                </div>

                <div class="grid-2-inner" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="form-group">
                        <label>Buy Price (Cost)</label>
                        <input type="number" id="prod-buy" step="0.01" min="0" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>Sell Price</label>
                        <input type="number" id="prod-sell" step="0.01" min="0" required placeholder="0.00">
                    </div>
                </div>

                <!-- Initial Stock Removed - Handled by Buy Transactions Only -->

                <!-- Advanced Unit Conversion -->
                <div class="form-group"
                    style="background:rgba(79, 70, 229, 0.1); padding:12px; border-radius:8px; margin-top:15px; border:1px solid rgba(79, 70, 229, 0.3);">
                    <label class="checkbox-label"
                        style="display:flex; align-items:center; gap:8px; cursor:pointer; margin-bottom:10px;">
                        <input type="checkbox" id="prod-has-conversion" onchange="toggleConversionFields()">
                        <span style="font-weight:600; color:var(--primary)">Enable Unit Conversion?</span>
                    </label>
                    <p style="font-size:0.75rem; color:var(--text-secondary); margin-bottom:10px;">
                        Use this if you Buy in one unit (e.g. Pack/KG) but Sell in another (KG/Meter).
                    </p>

                    <div id="prod-conversion-fields"
                        style="display:none; padding-top:10px; border-top:1px dashed rgba(255,255,255,0.1);">
                        <div class="grid-2-inner">
                            <div class="form-group" style="margin-bottom:0">
                                <label>Purchase Unit</label>
                                <input type="text" id="prod-buy-unit" placeholder="e.g. Box, Ton">
                            </div>
                            <div class="form-group" style="margin-bottom:0">
                                <label>Conversion Rate</label>
                                <input type="number" id="prod-conversion-rate" step="0.001" min="0"
                                    placeholder="e.g. 50">
                            </div>
                        </div>
                        <div style="font-size:0.8rem; color:#fbbf24; margin-top:8px; font-style:italic;">
                            Formula: 1 <span id="preview-buy-unit">[Unit]</span> = <span id="preview-rate">X</span>
                            <span id="preview-stock-unit">[Base]</span>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary full-width">Save Product</button>
            </form>
        </div>
    </div>

    <!-- Transaction Edit Modal -->
    <div id="transaction-edit-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3>Edit Transaction</h3>
                <button onclick="document.getElementById('transaction-edit-modal').classList.remove('active')"
                    class="icon-btn"><ion-icon name="close"></ion-icon></button>
            </div>
            <form onsubmit="updateTransaction(event)">
                <input type="hidden" id="edit-trans-id">
                <div class="form-group">
                    <label>Transaction Type</label>
                    <div class="radio-group">
                        <label class="radio-label type-in">
                            <input type="radio" name="edit-type" value="IN" id="edit-type-in">
                            <span><ion-icon name="arrow-down"></ion-icon> IN</span>
                        </label>
                        <label class="radio-label type-out">
                            <input type="radio" name="edit-type" value="OUT" id="edit-type-out">
                            <span><ion-icon name="arrow-up"></ion-icon> OUT</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="edit-trans-date" required>
                </div>

                <div class="form-group">
                    <label>Product (Read Only)</label>
                    <input type="text" id="edit-trans-product" readonly
                        style="background:rgba(255,255,255,0.05); color:var(--text-secondary)">
                </div>

                <div class="grid-2-inner">
                    <div class="form-group">
                        <label>Quantity</label>
                        <input type="number" id="edit-trans-qty" min="1" required>
                    </div>
                    <div class="form-group">
                        <label>Unit Price</label>
                        <input type="number" id="edit-trans-price" min="0" step="0.01" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Remarks</label>
                    <input type="text" id="edit-trans-notes">
                </div>

                <div class="form-group"
                    style="background:rgba(239, 68, 68, 0.1); padding:10px; border-radius:5px; border:1px solid rgba(239, 68, 68, 0.3);">
                    <small style="color:#fca5a5;">
                        <ion-icon name="warning-outline"></ion-icon>
                        Warning: Changing quantity or type will adjust current stock levels based on the difference.
                    </small>
                </div>

                <button type="submit" class="btn btn-primary full-width">Update Transaction</button>
            </form>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>
    <script src="app.js" defer></script>
</body>

</html>